{% load custom_filters %}
<h2 data-room-id="{{room.room_number}}" id="room-number">Room : {{room.room_number}}</h2>
<h2>Floor : {{room.floor|parse_floor}}</h2>
<h2>Type : {{room.type|parse_type}}</h2>
<h2>AC : {{room.ac|yesno:"Yes,No"}}</h2>
<h2>Status : {{room.occupied|yesno:"Occupied,Vaccant"}}</h2>
<br>
<button type="submit" id="booking-button">Book</button>
{% csrf_token %}
<script>
    const bookingButton = document.getElementById("booking-button")
    bookingButton.addEventListener("click",function(){
        createBooking()
    })
    function createBooking() {
        var url = "/core/create-booking/"
        var csrfToken = document.querySelector('input[name=csrfmiddlewaretoken]').value
        var roomNumber =  document.getElementById("room-number").getAttribute("data-room-id")
        console.log(JSON.stringify({"room_number":roomNumber}))
        fetch(url,{
            method:"POST",
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({"room_number":roomNumber})
        })
            .then((response) => response.json())
            .then((data) => {
            console.log(data)
            if(data.redirect) {
                console.log(data.redirect_url)
                window.location.href = data.edirect_url
            }
        })
            .catch((error) => {
            console.log(error)
        })
    }
</script>
